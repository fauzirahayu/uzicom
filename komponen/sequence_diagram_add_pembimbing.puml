@startuml Sequence Diagram Add Pembimbing

title Sequence Diagram - Tambah Pembimbing Haji

actor Admin
participant "List Pembimbing\n(pembimbing.php)" as PembimbingList
participant "Form Pembimbing\n(tambahPembimbing.php)" as FormPage
participant "addPembimbing.php" as AddProcess
participant "Upload Handler" as Upload
participant "Database" as DB

Admin -> PembimbingList: Akses halaman pembimbing
PembimbingList -> Admin: Tampilkan list pembimbing dengan tombol tambah

Admin -> FormPage: Klik tombol tambah
FormPage -> Admin: Tampilkan form tambah pembimbing (nama, NIK, telepon, email, alamat, foto, keterangan)

Admin -> FormPage: Isi form dan submit
FormPage -> AddProcess: POST: nama_lengkap, nik, telepon, email, alamat, keterangan, file foto

AddProcess -> AddProcess: Cek isset($_POST['tambah'])

alt File foto diupload
    AddProcess -> Upload: Process upload file
    
    Upload -> Upload: Validasi file tidak error (UPLOAD_ERR_OK)
    Upload -> Upload: Buat directory /uploads jika tidak ada
    Upload -> Upload: Buat filename dengan timestamp + sanitasi nama
    Upload -> Upload: Move uploaded file ke /uploads/
    
    alt Upload berhasil
        Upload --> AddProcess: Return filename
    else Upload gagal
        Upload -> Admin: Alert "Gagal upload file"
        AddProcess -> AddProcess: Exit process
    end
else Tidak ada file foto
    AddProcess -> AddProcess: Set name_file = '' (kosong)
end

AddProcess -> DB: INSERT INTO pembimbing_haji (nama_lengkap, nik, telepon, email, alamat, foto, keterangan)
DB --> AddProcess: Return insert result

alt Insert berhasil
    AddProcess -> PembimbingList: Redirect ke halaman pembimbing
    PembimbingList --> Admin: Tampilkan list pembimbing (pembimbing baru ada di list)
else Insert gagal
    AddProcess -> Admin: Tampilkan error message
end

@enduml
