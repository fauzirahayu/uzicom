@startuml Sequence Diagram Login

title Sequence Diagram - Login Sistem Manajemen Haji

actor User
participant "Halaman Login" as LoginPage
participant "sistem" as LoginProcess
participant "Database" as DB
participant "Admin Dashboard" as AdminDash
participant "User Dashboard" as UserDash

User -> LoginPage: Akses halaman login
LoginPage -> User: Tampilkan form login (email, password)

User -> LoginPage: Masukkan email dan password, submit
LoginPage -> LoginProcess: POST: email, password

LoginProcess -> LoginProcess: Trim dan escape input

LoginProcess -> DB: SELECT * FROM admin WHERE email=?
DB --> LoginProcess: Return admin record (jika ada)

alt Admin ditemukan
    LoginProcess -> LoginProcess: password_verify(password, hashed_password)
    
    alt Password benar
        LoginProcess -> LoginProcess: Set session (id, nama, email, role='admin')
        LoginProcess -> AdminDash: Redirect ke tampilan admin
        AdminDash --> User: Tampilkan dashboard admin
    else Password salah
LoginProcess -> LoginPage: Redirect dengan alert "Email atau Password salah!"
    end
else Admin tidak ditemukan
LoginProcess -> LoginPage: Redirect dengan alert "Email atau Password salah!"
LoginProcess -> LoginProcess: Check tabel pengguna
    LoginProcess -> DB: SELECT * FROM pengguna WHERE email=?
    DB --> LoginProcess: Return pengguna record (jika ada)
    
    alt Pengguna ditemukan
        LoginProcess -> LoginProcess: password_verify(password, hashed_password)
        
        alt Password benar
            LoginProcess -> LoginProcess: Set session (id, nama, email, role='user')
            LoginProcess -> UserDash: Redirect ke pengguna/sideMenu2.php
            UserDash --> User: Tampilkan dashboard pengguna
        else Password salah
            LoginProcess -> LoginPage: Redirect dengan alert "Email atau Password salah!"
        end
    else Pengguna tidak ditemukan
        LoginProcess -> LoginPage: Redirect dengan alert "Email atau Password salah!"
    end
end

@enduml
